services:
  recipes-db:
    restart: "always"
    image: "postgres:16-alpine"
    environment:
      - "TZ=Pacific/Auckland"
      - "SECRET_KEY=${RECIPES_SECRET_KEY}"
      - "DB_ENGINE=django.db.backends.postgresql"
      - "POSTGRES_HOST=recipes-db"
      - "POSTGRES_DB=djangodb"
      - "POSTGRES_PORT=5432"
      - "POSTGRES_USER=djangouser"
      - "POSTGRES_PASSWORD=${RECIPES_POSTGRES_PASSWORD}"
    volumes:
      - "recipes-postgres:/var/lib/postgresql/data"

  recipes:
    restart: "always"
    image: "vabene1111/recipes"
    environment:
      - "TZ=Pacific/Auckland"
      - "SECRET_KEY=${RECIPES_SECRET_KEY}"
      - "DB_ENGINE=django.db.backends.postgresql"
      - "POSTGRES_HOST=recipes-db"
      - "POSTGRES_DB=djangodb"
      - "POSTGRES_PORT=5432"
      - "POSTGRES_USER=djangouser"
      - "POSTGRES_PASSWORD=${RECIPES_POSTGRES_PASSWORD}"
    volumes:
      - "recipes-static:/opt/recipes/staticfiles"
      - "recipes-media:/opt/recipes/mediafiles"
    depends_on:
      - "recipes-db"
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.recipes.rule=Host(`recipes.tqid.dev`)"
      - "traefik.http.routers.recipes.entrypoints=web"

networks:
  default:

volumes:
  recipes-postgres:
  recipes-static:
  recipes-media: